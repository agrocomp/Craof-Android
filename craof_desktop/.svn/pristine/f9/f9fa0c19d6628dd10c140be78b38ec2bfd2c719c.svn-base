/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package screen.craof.insumo;

import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import org.controle.craof.Controle_CRUD_Insumo;
import org.entidade.craof.Insumo;
import screen.craof.FrameAuxiliar;
import screen.craof.SegundaTela;
import screen.craof.cultura.PanelCulturaBuscar;
import screen.craof.fichas.CompraInsumos.CompraInsumosCadastrar;

/**
 *
 * @author Luan
 */
public class PanelInsumoCadastrar extends javax.swing.JPanel {

    /**
     * Creates new form PanelInsumoCadastro
     */
    public PanelInsumoCadastrar(JFrame frame) {
        initComponents();
        this.frame = frame;
        inicializar();
    }

    public void inicializar() {
        buscar.setVisible(false);
        excluir.setVisible(false);
        wsingredientes.setVisible(false);
        wtbingredientes.setVisible(false);
        excluir.setVisible(false);
        adicionar.setVisible(false);
        wl1.setVisible(false);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        wlCodigo = new javax.swing.JLabel();
        wtCodigo = new javax.swing.JTextField();
        wlDescricao = new javax.swing.JLabel();
        wtDescricao = new javax.swing.JTextField();
        wlProduzido = new javax.swing.JLabel();
        jcSim = new javax.swing.JCheckBox();
        wsingredientes = new javax.swing.JScrollPane();
        wtbingredientes = new javax.swing.JTable();
        salvar = new javax.swing.JButton();
        cancelar = new javax.swing.JButton();
        buscar = new javax.swing.JButton();
        adicionar = new javax.swing.JButton();
        excluir = new javax.swing.JButton();
        wl1 = new javax.swing.JLabel();

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel1.setText("CADASTRO DE LOCAL");

        jLabel2.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jLabel2.setText("CADASTRO DE INSUMOS");

        wlCodigo.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        wlCodigo.setText("Código:");

        wtCodigo.setEditable(false);
        wtCodigo.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        wtCodigo.setText("Automático");

        wlDescricao.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        wlDescricao.setText("Descrição do Insumo:");

        wtDescricao.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N

        wlProduzido.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        wlProduzido.setText("Produzido no Local:");

        jcSim.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jcSim.setText("Sim");
        jcSim.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jcSimActionPerformed(evt);
            }
        });

        wtbingredientes.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Código do Insumo", "Descrição do Insumo"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        wsingredientes.setViewportView(wtbingredientes);

        salvar.setText("SALVAR");
        salvar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                salvarActionPerformed(evt);
            }
        });

        cancelar.setText("CANCELAR");
        cancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cancelarActionPerformed(evt);
            }
        });

        buscar.setText("BUSCAR");
        buscar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                buscarActionPerformed(evt);
            }
        });

        adicionar.setText("ADICIONAR");

        excluir.setText("EXCLUIR");

        wl1.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        wl1.setText("Ingredientes");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(wsingredientes, javax.swing.GroupLayout.DEFAULT_SIZE, 472, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(adicionar, javax.swing.GroupLayout.DEFAULT_SIZE, 95, Short.MAX_VALUE)
                            .addComponent(buscar, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(excluir, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(209, 209, 209)
                                .addComponent(jLabel2))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(19, 19, 19)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(wlDescricao)
                                    .addComponent(wlCodigo)
                                    .addComponent(wlProduzido))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(wtCodigo, javax.swing.GroupLayout.PREFERRED_SIZE, 98, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(wtDescricao, javax.swing.GroupLayout.PREFERRED_SIZE, 185, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(jcSim)))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(195, 195, 195)
                                .addComponent(salvar)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(cancelar)))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addGap(223, 223, 223)
                .addComponent(wl1)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jLabel2)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(wlCodigo)
                    .addComponent(wtCodigo, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(wlDescricao)
                    .addComponent(wtDescricao, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(wlProduzido)
                    .addComponent(jcSim))
                .addGap(8, 8, 8)
                .addComponent(wl1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(wsingredientes, javax.swing.GroupLayout.PREFERRED_SIZE, 148, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(buscar)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(adicionar)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(excluir)
                        .addGap(36, 36, 36)))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cancelar)
                    .addComponent(salvar))
                .addContainerGap(17, Short.MAX_VALUE))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void jcSimActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jcSimActionPerformed
        if (jcSim.isSelected()) {
            buscar.setVisible(true);
            excluir.setVisible(true);
            wsingredientes.setVisible(true);
            wl1.setVisible(true);
            wtbingredientes.setVisible(true);
            adicionar.setVisible(true);
        } else {
            buscar.setVisible(false);
            excluir.setVisible(false);
            wsingredientes.setVisible(false);
            wl1.setVisible(false);
            adicionar.setVisible(false);
            wtbingredientes.setVisible(false);
        }
        if (frame instanceof SegundaTela) {
            ((SegundaTela) frame).corrigir();
        }
    }//GEN-LAST:event_jcSimActionPerformed

    private void salvarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_salvarActionPerformed
        //cadastrar no banco (GOKU)
        Insumo insumo = new Insumo();
        controle = new Controle_CRUD_Insumo();
        insumo.setDescricao(wtDescricao.getText());
        insumo.setId_usuario(1);
        insumo.setFlagProducao(jcSim.isSelected());
        if (!jcSim.isSelected()) {
            try {
                if (!controle.salvar(insumo)) {
                    JOptionPane.showMessageDialog(null, "Cadastro realizado com sucesso!");
                } else {
                    JOptionPane.showMessageDialog(null, "ERROR CRAOFx03 : Falha ao cadastrar insumo!");
                }
            } catch (SQLException ex) {
                Logger.getLogger(PanelInsumoCadastrar.class.getName()).log(Level.SEVERE, null, ex);
            }
        } else {
            for (int i = 0; i < wtbingredientes.getRowCount(); i++) {
                Insumo aux = new Insumo();
                aux.setId_insumo((Integer) wtbingredientes.getValueAt(i, 0));
                insumo.getListaInsumo().add(aux);
            }
            try {
                if (controle.salvar(insumo)) {
                    JOptionPane.showMessageDialog(null, "Cadastro realizado com sucesso!");
                } else {
                    JOptionPane.showMessageDialog(null, "ERROR CRAOFx03 : Falha ao cadastrar insumo!");
                }
            } catch (SQLException ex) {
                Logger.getLogger(PanelInsumoCadastrar.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
        if (frame instanceof FrameAuxiliar) {
            FrameAuxiliar c = (FrameAuxiliar) frame;
            if (c.getPanel() instanceof PanelInsumoBuscar) {
               // ((PanelInsumoBuscar) c.getPanel()).inserirTabela(insumo);
            } else if (c.getPanel() instanceof CompraInsumosCadastrar) {
                int id;
                try {
                   insumo.setId_insumo(controle.buscarId(insumo));
                    ((CompraInsumosCadastrar) c.getPanel()).setInsumo(insumo);//buscar o id do insumo;
                } catch (SQLException ex) {
                    Logger.getLogger(PanelInsumoCadastrar.class.getName()).log(Level.SEVERE, null, ex);
                }
                
            }
        }


    }//GEN-LAST:event_salvarActionPerformed

    private void cancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cancelarActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_cancelarActionPerformed

    private void buscarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_buscarActionPerformed
        FrameAuxiliar c = new FrameAuxiliar(this);
        c.abrirPanel(new PanelInsumoBuscar(c), "Buscar ");
        c.setVisible(true);
    }//GEN-LAST:event_buscarActionPerformed

    public void inserirTabela(Insumo insumo) {
        DefaultTableModel model = (DefaultTableModel) wtbingredientes.getModel();
        model.addRow(new Object[]{insumo.getId_insumo(), insumo.getDescricao()});
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton adicionar;
    private javax.swing.JButton buscar;
    private javax.swing.JButton cancelar;
    private javax.swing.JButton excluir;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JCheckBox jcSim;
    private javax.swing.JButton salvar;
    private javax.swing.JLabel wl1;
    private javax.swing.JLabel wlCodigo;
    private javax.swing.JLabel wlDescricao;
    private javax.swing.JLabel wlProduzido;
    private javax.swing.JScrollPane wsingredientes;
    private javax.swing.JTextField wtCodigo;
    private javax.swing.JTextField wtDescricao;
    private javax.swing.JTable wtbingredientes;
    // End of variables declaration//GEN-END:variables
    private JFrame frame;
    private Controle_CRUD_Insumo controle;
}
